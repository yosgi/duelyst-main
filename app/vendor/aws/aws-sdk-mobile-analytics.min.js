!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(c){var d=c.AMA;d.Storage=a("./StorageClients/LocalStorage.js"),d.StorageKeys=a("./StorageClients/StorageKeys.js"),d.Util=a("./MobileAnalyticsUtilities.js"),d.Client=function(){"use strict";var a=function(a){return Function.prototype.bind||(Function.prototype.bind=function(a){"function"!=typeof this&&this.logger.error("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,e=function(){return c.apply(this instanceof d.Util.NOP&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.Util.NOP.prototype=this.prototype,e.prototype=new d.Util.NOP,e}),this.options=a||{},this.options.logger=this.options.logger||{},this.logger={log:this.options.logger.log||d.Util.NOP,info:this.options.logger.info||d.Util.NOP,warn:this.options.logger.warn||d.Util.NOP,error:this.options.logger.error||d.Util.NOP},this.logger.log=this.logger.log.bind(this.options.logger),this.logger.info=this.logger.info.bind(this.options.logger),this.logger.warn=this.logger.warn.bind(this.options.logger),this.logger.error=this.logger.error.bind(this.options.logger),d.Storage.setLogger(this.logger),this.logger.log("[Function:(AMA)Client Constructor]"+(a?"\noptions:"+JSON.stringify(a):"")),void 0===a.appId?(this.logger.error("AMA.Client must be initialized with an appId"),null):(void 0===a.platform&&this.logger.error("AMA.Client must be initialized with a platform"),this.options.apiVersion=this.options.apiVersion||"2014-06-05",this.options.provider=this.options.provider||AWS.config.credentials,this.options.autoSubmitEvents=void 0!==a.autoSubmitEvents?a.autoSubmitEvents:!0,this.options.autoSubmitInterval=this.options.autoSubmitInterval||1e4,this.options.batchSizeLimit=this.options.batchSizeLimit||256e3,this.options.submitCallback=this.options.submitCallback||d.Util.NOP,this.options.globalAttributes=this.options.globalAttributes||{},this.options.globalMetrics=this.options.globalMetrics||{},d.Storage.set(d.StorageKeys.GLOBAL_ATTRIBUTES,d.Util.mergeObjects(this.options.globalAttributes,d.Storage.get(d.StorageKeys.GLOBAL_ATTRIBUTES)||{})),d.Storage.set(d.StorageKeys.GLOBAL_METRICS,d.Util.mergeObjects(this.options.globalMetrics,d.Storage.get(d.StorageKeys.GLOBAL_METRICS)||{})),this.options.clientContext=this.options.clientContext||{client:{client_id:this.options.clientId||d.Util.GetClientId(),app_title:this.options.appTitle,app_version_name:this.options.appVersionName,app_version_code:this.options.appVersionCode,app_package_name:this.options.appPackageName},env:{platform:this.options.platform,platform_version:this.options.platformVersion,model:this.options.model,make:this.options.make,locale:this.options.locale},services:{mobile_analytics:{app_id:this.options.appId,sdk_name:"aws-sdk-mobile-analytics-js",sdk_version:"0.9.0"}},custom:{}},this.StorageKeys={EVENTS:"AWSMobileAnalyticsEventStorage",BATCHES:"AWSMobileAnalyticsBatchStorage",BATCH_INDEX:"AWSMobileAnalyticsBatchIndexStorage"},this.outputs={},this.outputs.MobileAnalytics=new AWS.MobileAnalytics({apiVersion:this.options.apiVersion,provider:this.options.provider}),this.outputs.timeoutReference=null,this.outputs.events=d.Storage.get(this.StorageKeys.EVENTS)||[],this.outputs.batches=d.Storage.get(this.StorageKeys.BATCHES)||{},this.outputs.batchIndex=d.Storage.get(this.StorageKeys.BATCH_INDEX)||[],void this.submitEvents())};return a.prototype.validateEvent=function(a){function b(a){return 0===a.length?!0:a.length>50}function c(b){return a.attributes[b]&&a.attributes[b].length>200}function d(a){return e.logger.error(a),null}var e=this,f=[];return f=Object.keys(a.metrics).filter(function(b){return"number"!=typeof a.metrics[b]}),"v2.0"!==a.version?d("Event must have version v2.0"):"string"!=typeof a.eventType?d("Event Type must be a string"):f.length>0?d("Event Metrics must be numeric ("+f[0]+")"):Object.keys(a.metrics).length+Object.keys(a.attributes).length>40?d("Event Metric and Attribute Count cannot exceed 40"):Object.keys(a.attributes).filter(b).length?d("Event Attribute names must be 1-50 characters"):Object.keys(a.metrics).filter(b).length?d("Event Metric names must be 1-50 characters"):Object.keys(a.attributes).filter(c).length?d("Event Attribute values cannot be longer than 200 characters"):a},a.prototype.createEvent=function(a,b,c,e){var f=this;this.logger.log("[Function:(AMA.Client).createEvent]"+(a?"\neventType:"+a:"")+(b?"\nsession:"+b:"")+(c?"\nattributes:"+JSON.stringify(c):"")+(e?"\nmetrics:"+JSON.stringify(e):"")),c=c||{},e=e||{},d.Util.mergeObjects(c,this.options.globalAttributes),d.Util.mergeObjects(e,this.options.globalMetrics),Object.keys(c).forEach(function(a){if("string"!=typeof c[a])try{c[a]=JSON.stringify(c[a])}catch(b){f.logger.warn("Error parsing attribute "+a)}});var g={eventType:a,timestamp:(new Date).toISOString(),session:{id:b.id,startTimestamp:b.startTimestamp},version:"v2.0",attributes:c,metrics:e};return b.stopTimestamp&&(g.session.stopTimestamp=b.stopTimestamp,g.session.duration=new Date(g.stopTimestamp).getTime()-new Date(g.startTimestamp).getTime()),this.validateEvent(g)},a.prototype.pushEvent=function(a){if(!a)return-1;this.logger.log("[Function:(AMA.Client).pushEvent]"+(a?"\nevent:"+JSON.stringify(a):""));var b=this.outputs.events.push(a);return d.Storage.set(this.StorageKeys.EVENTS,this.outputs.events),b-1},a.prototype.recordEvent=function(a,b,c,e){this.logger.log("[Function:(AMA.Client).recordEvent]"+(a?"\neventType:"+a:"")+(b?"\nsession:"+b:"")+(c?"\nattributes:"+JSON.stringify(c):"")+(e?"\nmetrics:"+JSON.stringify(e):""));var f,g=this.createEvent(a,b,c,e);return g?(f=this.pushEvent(g),d.Util.getRequestBodySize(this.outputs.events)>=this.options.batchSizeLimit&&this.submitEvents(),this.outputs.events[f]):null},a.prototype.recordMonetizationEvent=function(a,b,c,d){return this.logger.log("[Function:(AMA.Client).recordMonetizationEvent]"+(a?"\nsession:"+a:"")+(b?"\nmonetizationDetails:"+JSON.stringify(b):"")+(c?"\nattributes:"+JSON.stringify(c):"")+(d?"\nmetrics:"+JSON.stringify(d):"")),c=c||{},d=d||{},c._currency=b.currency||c._currency,c._product_id=b.productId||c._product_id,d._quantity=b.quantity||d._quantity,"number"==typeof b.price?d._item_price=b.price||d._item_price:c._item_price_formatted=b.price||c._item_price_formatted,this.recordEvent("_monetization.purchase",a,c,d)},a.prototype.submitEvents=function(a){if(a=a||{},a.submitCallback=a.submitCallback||this.options.submitCallback,this.logger.log("[Function:(AMA.Client).submitEvents]"+(a?"\noptions:"+JSON.stringify(a):"")),this.outputs.lastSubmitTimestamp&&(new Date).getTime()-this.outputs.lastSubmitTimestamp<1e3)return this.logger.warn("Prevented multiple submissions in under a second"),[];this.outputs.lastSubmitTimestamp=(new Date).getTime();var b,c,e;for(a=a||{},this.options.autoSubmitEvents&&(clearTimeout(this.outputs.timeoutReference),this.outputs.timeoutReference=setTimeout(this.submitEvents.bind(this),this.options.autoSubmitInterval));this.outputs.events.length>0;){for(b=this.outputs.events.length,this.logger.log(this.outputs.events.length+" events to be submitted");b>1&&d.Util.getRequestBodySize(this.outputs.events.slice(0,b))>this.options.batchSizeLimit;)this.logger.log("Finding Batch Size ("+this.options.batchSizeLimit+"): "+b+"("+d.Util.getRequestBodySize(this.outputs.events.slice(0,b))+")"),b-=1;e=this.outputs.events.slice(0,b),this.logger.log(e.length+" events in batch"),d.Util.getRequestBodySize(e)<512e3?(c=d.Util.GUID(),this.outputs.batches[c]=e,d.Storage.set(this.StorageKeys.BATCHES,this.outputs.batches),this.outputs.batchIndex.push(c),d.Storage.set(this.StorageKeys.BATCH_INDEX,this.outputs.batchIndex),this.outputs.events.splice(0,b),d.Storage.set(this.StorageKeys.EVENTS,this.outputs.events)):this.logger.error("Events too large")}return this.submitAllBatches(a)},a.prototype.submitAllBatches=function(a){a.submitCallback=a.submitCallback||this.options.submitCallback,this.logger.log("[Function:(AMA.Client).submitAllBatches]"+(a?"\noptions:"+JSON.stringify(a):""));var b=[],c=this;return this.outputs.batchIndex.forEach(function(d){a.batchId=d,a.clientContext=a.clientContext||c.options.clientContext,c.submitBatchById(a),b.push(d)}),b},a.prototype.clearBatchById=function(a){this.logger.log("[Function:(AMA.Client).clearBatchById]"+(a?"\nbatchId:"+a:"")),-1!==this.outputs.batchIndex.indexOf(a)&&(delete this.outputs.batches[a],this.outputs.batchIndex.splice(this.outputs.batchIndex.indexOf(a),1),d.Storage.set(this.StorageKeys.BATCH_INDEX,this.outputs.batchIndex),d.Storage.set(this.StorageKeys.BATCHES,this.outputs.batches))},a.NON_RETRYABLE_EXCEPTIONS=["BadRequestException","SerializationException","ValidationException"],a.prototype.submitBatchById=function(b){b=b||{},b.submitCallback=b.submitCallback||this.options.submitCallback,this.logger.log("[Function:(AMA.Client).submitBatchById]"+(b?"\noptions:"+JSON.stringify(b):""));var c={events:this.outputs.batches[b.batchId],clientContext:JSON.stringify(b.clientContext||this.options.clientContext)},d=this;this.outputs.MobileAnalytics.putEvents(c,function(c,e){var f=!0;b.submitCallback(c,e,b.batchId),c?(d.logger.error(c,e),(void 0===c.statusCode||400===c.statusCode)&&a.NON_RETRYABLE_EXCEPTIONS.indexOf(c.code)<0&&(f=!1)):d.logger.info("Events Submitted Successfully"),f&&d.clearBatchById(b.batchId)})},a}(),b.exports=d.Client}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./MobileAnalyticsUtilities.js":4,"./StorageClients/LocalStorage.js":5,"./StorageClients/StorageKeys.js":6}],2:[function(a,b){(function(c){var d=c.AMA;d.Storage=a("./StorageClients/LocalStorage.js"),d.StorageKeys=a("./StorageClients/StorageKeys.js"),d.Util=a("./MobileAnalyticsUtilities.js"),d.Session=function(){"use strict";var a=function(a){this.options=a||{},this.options.logger=this.options.logger||{},this.logger={log:this.options.logger.log||d.Util.NOP,info:this.options.logger.info||d.Util.NOP,warn:this.options.logger.warn||d.Util.NOP,error:this.options.logger.error||d.Util.NOP},this.logger.log=this.logger.log.bind(this.options.logger),this.logger.info=this.logger.info.bind(this.options.logger),this.logger.warn=this.logger.warn.bind(this.options.logger),this.logger.error=this.logger.error.bind(this.options.logger),this.logger.log("[Function:(AWS.MobileAnalyticsClient)Session Constructor]"+(a?"\noptions:"+JSON.stringify(a):"")),this.options.expirationCallback=this.options.expirationCallback||d.Util.NOP,this.id=this.options.sessionId||d.Util.GUID(),this.sessionLength=this.options.sessionLength||6e5,this.StorageKeys={SESSION_ID:d.StorageKeys.SESSION_ID+this.id,SESSION_EXPIRATION:d.StorageKeys.SESSION_EXPIRATION+this.id,SESSION_START_TIMESTAMP:d.StorageKeys.SESSION_START_TIMESTAMP+this.id},this.startTimestamp=this.options.startTime||d.Storage.get(this.StorageKeys.SESSION_START_TIMESTAMP)||(new Date).toISOString(),this.expirationDate=parseInt(d.Storage.get(this.StorageKeys.SESSION_EXPIRATION),10),isNaN(this.expirationDate)&&(this.expirationDate=(new Date).getTime()+this.sessionLength),d.Storage.set(this.StorageKeys.SESSION_ID,this.id),d.Storage.set(this.StorageKeys.SESSION_EXPIRATION,this.expirationDate),d.Storage.set(this.StorageKeys.SESSION_START_TIMESTAMP,this.startTimestamp),this.sessionTimeoutReference=setTimeout(this.expireSession.bind(this),this.sessionLength)};return a.prototype.expireSession=function(a){this.logger.log("[Function:(Session).expireSession]"),a=a||this.options.expirationCallback;var b=a(this);"boolean"==typeof b&&b&&(b=this.options.sessionLength),"number"==typeof b?this.extendSession(b):this.clearSession()},a.prototype.clearSession=function(){this.logger.log("[Function:(Session).clearSession]"),clearTimeout(this.sessionTimeoutReference),d.Storage["delete"](this.StorageKeys.SESSION_ID),d.Storage["delete"](this.StorageKeys.SESSION_EXPIRATION),d.Storage["delete"](this.StorageKeys.SESSION_START_TIMESTAMP)},a.prototype.extendSession=function(a){this.logger.log("[Function:(Session).extendSession]"+(a?"\nsessionExtensionLength:"+a:"")),a=a||this.sessionLength,this.setSessionTimeout(this.expirationDate+parseInt(a,10))},a.prototype.stopSession=function(a){this.logger.log("[Function:(Session).stopSession]"+(a?"\nstopDate:"+a:"")),this.stopTimestamp=a||(new Date).toISOString()},a.prototype.resetSessionTimeout=function(a){this.logger.log("[Function:(Session).resetSessionTimeout]"+(a?"\nmilliseconds:"+a:"")),a=a||this.sessionLength,this.setSessionTimeout((new Date).getTime()+a)},a.prototype.setSessionTimeout=function(a){this.logger.log("[Function:(Session).setSessionTimeout]"+(a?"\ntimeout:"+a:"")),clearTimeout(this.sessionTimeoutReference),this.expirationDate=a,d.Storage.set(this.StorageKeys.SESSION_EXPIRATION,this.expirationDate),this.sessionTimeoutReference=setTimeout(this.expireSession.bind(this),this.expirationDate-(new Date).getTime())},a}(),b.exports=d.Session}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./MobileAnalyticsUtilities.js":4,"./StorageClients/LocalStorage.js":5,"./StorageClients/StorageKeys.js":6}],3:[function(a,b){(function(c){var d=c.AMA;d.Storage=a("./StorageClients/LocalStorage.js"),d.StorageKeys=a("./StorageClients/StorageKeys.js"),d.Session=a("./MobileAnalyticsSession.js"),d.Client=a("./MobileAnalyticsClient.js"),d.Manager=function(){"use strict";var a=function(a){function b(a){d.Storage.each(function(b){0===b.indexOf(d.StorageKeys.SESSION_ID)&&(a.outputs.session=new d.Session({sessionId:d.Storage.get(b),sessionLength:a.options.sessionLength,expirationCallback:function(b){var c=a.options.expirationCallback(b);return c===!0||"number"==typeof c?c:void a.stopSession()}}),(new Date).getTime()>a.outputs.session.expirationDate&&(a.outputs.session.expireSession(),delete a.outputs.session))})}this.client=a instanceof d.Client?a:new d.Client(a),this.options=this.client.options,this.outputs=this.client.outputs,this.options.expirationCallback=this.options.expirationCallback||d.Util.NOP,b(this),this.outputs.session||this.startSession(),this.client.submitEvents()};return a.prototype.submitEvents=function(a){return this.client.submitEvents(a)},a.prototype.startSession=function(){return this.client.logger.log("[Function:(AMA.Manager).startSession]"),this.outputs.session&&this.outputs.session.clearSession(),this.outputs.session=new d.Session({logger:this.client.options.logger,sessionLength:this.options.sessionLength,expirationCallback:function(a){var b=this.options.expirationCallback(a);return b===!0||"number"==typeof b?b:void this.stopSession()}.bind(this)}),this.recordEvent("_session.start")},a.prototype.extendSession=function(a){return this.outputs.session.extendSession(a||this.options.sessionLength)},a.prototype.stopSession=function(){return this.client.logger.log("[Function:(AMA.Manager).stopSession]"),this.outputs.session.stopSession(),this.outputs.session.expireSession(d.Util.NOP),this.recordEvent("_session.stop")},a.prototype.renewSession=function(){return this.stopSession(),this.startSession(),this.outputs.session},a.prototype.createEvent=function(a,b,c){return this.client.createEvent(a,this.outputs.session,b,c)},a.prototype.recordEvent=function(a,b,c){return this.client.recordEvent(a,this.outputs.session,b,c)},a.prototype.recordMonetizationEvent=function(a,b,c){return this.client.recordMonetizationEvent(this.outputs.session,a,b,c)},a}(),b.exports=d.Manager}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./MobileAnalyticsClient.js":1,"./MobileAnalyticsSession.js":2,"./StorageClients/LocalStorage.js":5,"./StorageClients/StorageKeys.js":6}],4:[function(a,b){(function(c){var d=c.AMA;d.Storage=a("./StorageClients/LocalStorage.js"),d.StorageKeys=a("./StorageClients/StorageKeys.js"),d.Util=function(){"use strict";function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function b(a){"string"!=typeof a&&(a=JSON.stringify(a));var b,c,d=a.length;for(b=a.length-1;b>=0;b-=1)c=a.charCodeAt(b),c>127&&2047>=c?d+=1:c>2047&&65535>=c&&(d+=2),c>=56320&&57343>=c&&(b-=1);return d}function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function e(){return void 0===d.Storage.get(d.StorageKeys.CLIENT_ID)&&d.Storage.set(d.StorageKeys.CLIENT_ID,c()),d.Storage.get(d.StorageKeys.CLIENT_ID)}function f(a,b){return Object.keys(b).forEach(function(c){b.hasOwnProperty(c)&&(a[c]=a[c]||b[c])}),a}function g(a,b){return f(JSON.parse(JSON.stringify(a)),b)}function h(){return void 0}return{copy:g,GUID:c,GetClientId:e,getRequestBodySize:b,mergeObjects:f,NOP:h}}(),b.exports=d.Util}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./StorageClients/LocalStorage.js":5,"./StorageClients/StorageKeys.js":6}],5:[function(a,b){(function(c){var d=c.AMA;d.Util=a("../MobileAnalyticsUtilities.js"),d.Storage=function(){"use strict";function a(){try{return window&&window.localStorage}catch(a){return!1}}function b(){if(h={},a())try{f&&f.log("[Function:(AWS.MobileAnalyticsClient.Storage).clearLocalStorage]"),window.localStorage.removeItem(g)}catch(b){console.log("Error clearing LocalStorage: "+JSON.stringify(b))}else console.log("LocalStorage is not available")}function c(){if(a()){var c;try{if(f&&f.log("[Function:(AWS.MobileAnalyticsClient.Storage).loadLocalStorage]"),c=window.localStorage.getItem(g),f&&f.log("LocalStorage Cache: "+c),c)try{h=JSON.parse(c)}catch(d){b()}}catch(e){console.log("Error loading LocalStorage: "+JSON.stringify(e)),b()}}else console.log("LocalStorage is not available")}function e(){if(a())try{f&&f.log("[Function:(AWS.MobileAnalyticsClient.Storage).saveToLocalStorage]"),window.localStorage.setItem(g,JSON.stringify(h)),f&&f.log("LocalStorage Cache: "+JSON.stringify(h))}catch(b){console.log("Error saving to LocalStorage: "+JSON.stringify(b))}else console.log("LocalStorage is not available")}var f,g="AWSMobileAnalyticsStorage",h={};return c(),{type:"LOCAL_STORAGE",id:d.Util.GUID(),get:function(a){return h[a]},set:function(a,b){h[a]=b,e()},"delete":function(a){delete h[a],e()},each:function(a){var b;for(b in h)h.hasOwnProperty(b)&&a(b,h[b])},reload:c,setLogger:function(a){f=a},supportsLocalStorage:a,clearLocalStorage:b}}(),b.exports=d.Storage}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../MobileAnalyticsUtilities.js":4}],6:[function(a,b){(function(a){var c=a.AMA;c.StorageKeys={CLIENT_ID:"AWSMobileAnalyticsClientId",GLOBAL_ATTRIBUTES:"AWSMobileAnalyticsGlobalAttributes",GLOBAL_METRICS:"AWSMobileAnalyticsGlobalMetrics",SESSION_ID:"MobileAnalyticsSessionId",SESSION_EXPIRATION:"MobileAnalyticsSessionExpiration",SESSION_START_TIMESTAMP:"MobileAnalyticsSessionStartTimeStamp"},b.exports=c.StorageKeys}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(a,b){(function(c){c.AMA=c.AMA||{},a("./MobileAnalyticsClient.js"),a("./MobileAnalyticsUtilities.js"),a("./StorageClients/StorageKeys.js"),a("./StorageClients/LocalStorage.js"),a("./MobileAnalyticsSession.js"),a("./MobileAnalyticsSessionManager.js"),b.exports=c.AMA}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./MobileAnalyticsClient.js":1,"./MobileAnalyticsSession.js":2,"./MobileAnalyticsSessionManager.js":3,"./MobileAnalyticsUtilities.js":4,"./StorageClients/LocalStorage.js":5,"./StorageClients/StorageKeys.js":6}]},{},[7]);
