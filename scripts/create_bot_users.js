require('coffeescript/register');
const path = require('path');
require('app-module-path').addPath(path.join(__dirname, '../'));
const _ = require('underscore');
const DuelystFirebase = require('../server/lib/duelyst_firebase_module.coffee');
const FirebasePromises = require('../server/lib/firebase_promises.coffee');
const UsersModule = require('../server/lib/data_access/users.coffee');
const generatePushId = require('../app/common/generate_push_id');
const knex = require('../server/lib/data_access/knex.coffee');
// var PortraitLookup = require('../app/sdk/portraits/portraitLookup.coffee')

const usernames = [
  'SmoulderingJade',
  'Arianela',
  'Aldina',
  'Tudys',
  'Kaalanna',
  'Nargyel',
  'Kaetya',
  'Miota',
  'Narenip',
  'Aigala',
  'Lenina',
  'Kaina',
  'Afryon',
  'Teosys',
  'Falyla',
  'Faegona',
  'Cudae',
  'Nitil',
  'Tugon',
  'Zyizz',
  'DiamondHoarder',
  'Tsalmer',
  'Haghisinger',
  'PhibixTheMaster',
  'Zismir',
  'Ylawick',
  'Jeiqui',
  'Medliben',
  'Anwel',
  'Mellessil',
  'Rirosseth',
  'Thialfi',
  'BigRogni',
  'Gundriksson',
  'Alfginnarsson',
  'Borrisson',
  'HakiFromRussia',
  'GoremPoland',
  'Boltonfan',
  'AshleyT',
  'MarinaP',
  'Sunni',
  'RedSkorina',
  'DragonLovely',
  'CoolPete',
  'PrincessPunk',
  'BigBagwood',
  'BorgLord',
  'LoudTrumpet',
  'NeoLobster',
  'Heliana',
  'ProfessorCat',
  'KingKwame',
  'Salomao',
  'DexTRex',
  'Alexandros',
  'Hladimir1000',
  'Botros12',
  'AlJarah',
  'Bilal2Win',
  'AlimAlim',
  'Hakan2000',
  'DaisukeTaro',
  'SanilMMM',
  'KamalaTheBear',
  'TopYoghurt',
  'Nagib84',
  'DenizPants',
  'KimoKimo',
  'Kekoa1',
  'YukiCake',
  'PonKulap',
  'RoboNaomi',
  'OvalKettle',
  'Spoon11',
  'ElatedCream',
  'ChubbyScience',
  'MuddleMusic',
  'KnotQueen',
  'RustySink',
  'CodyTaxMan',
  'VenomWish',
  'SpectacularSandboy',
  'YourAunt',
  'ConditionBlue',
  'GoodHaircut',
  'Noboyukiatwork',
  'SadAgung',
  'MasterYori',
  'IAmYoda',
  'BoNinja',
  'StalePancake',
  'Smokefather',
  'Wisehouse',
  'Forkit',
  'CoalRocks',
  'AntCat',
  'WelshTomatoe',
  'FamilyDog',
  'EternalButterJam',
  'First111',
  'LegendaryBeard',
  'CruelBanana',
  'CutSneak',
  'JJFromFuture',
  'Slvrgod',
  'TheForm',
  'AbacusFish',
  'SaveTrees',
  'KillBreath',
  'Kurokigane',
  'Blightfang',
  'VeryViewtifulJoe',
  'theONLYbob',
  'Magic8Ball',
  'Stratomir7',
  'Zelosis',
  'Xplosive00',
  'Azuresora',
  'Xenophage',
  'YukiShiroe',
  'ShinySuicune',
  'Jaxi4Life',
  'objectionist',
  'AvatarAang',
  'feralu',
  'newClassic',
  'magiclightsaber',
  'maryashley',
  'madscientist',
  'Catastrofie',
  'Systematical',
  'DuelystnChill',
  'Draconigate',
  'Shooouryuken',
  'AttackonSonghai',
  'Sangstar9',
  'RNGist',
  'Grimgare',
  'MasterOfSkrims',
  'lowKeyCrying',
  'HeartoftheCards',
  'stormbringer',
  'itstimetoduelyst',
  'SetoKaiba',
  'Judgeman',
  'EchoChamber',
  'Lonefire',
  'Countercept',
  'ShrekisLife',
  'Demonicore',
  'Venomic',
  'GnomKnight',
  'Seraphic',
  'Boomster8',
  'MurasakiPrism',
  'Metavolution',
  'Revolushun',
  'Shunmeister',
  'HailHelix',
  'CookieCutter',
  'Lunadraco',
  'Phinyx',
  'MiserySignals',
  'Verteigo',
  'Implozion',
  'Slithereon',
  'iamSmeb',
  'Zenosphere',
  'OneMOAR',
  'Raite',
  '3nforcers',
  'Balthezar',
  'Corrupticator',
  'UmaruKola',
  'Orangekun',
  'Kokakora',
  'BingePlayer',
  'momiamhungry',
  'phokingNoodles',
  'TrumptheTrump',
  'BeNicePlez',
  'Submaren',
  'CaptainChoppa',
  'Madhatter69',
  'InsanoSam',
  'InShane',
  'Zabumafu',
  'DaigurenHyorinmaru',
  'ZetaBeam',
  'OmegaOhm',
  'StaticVergil',
  'CheshireKat',
  'StayWelmed',
  'IfeeltheAster',
  'AshenDragon',
  'theFallingFallen',
  'Lanturns',
  'Pokeatery',
  'twinmacer',
  'Polkais',
  'Zentsuiken',
  'Raijhinken',
  'DJColored',
  'uPhone',
  'theDubNation',
  'Dekubara',
  'Kimchichi',
  'Haisayshi',
  'InaiMachi',
  'knowHamtaro',
  'FudisGud',
  'Brisingr',
  'Aragoraba',
  'SheepSeki',
  'imnotFaker',
  'Vaticalean',
  'DraconFly',
  'RakaBanana',
  'darkmarauder',
  'NotaCow',
  'Amazingmace',
  'lolimonster',
  'doombread',
  'mycoffeebrew',
  'genuinelynot',
  'horsepaste',
  'underabove',
  'ragemongrel',
  'stupidlysmart',
  'derpborne',
  'justaspawn',
  'quadforce',
  'tommarcy',
  'biancathequeen',
  'tildebestkey',
  'lightraiden',
  'another25mins',
  'top4orbust',
  'falcoitaint',
  'moonborne',
  'superdupernothing',
  '50times1',
  'superflye',
  'theAddition',
  'manymanner',
  'mickeymao',
  'hypervex',
  'silverthorn',
  'felwolfie',
  'elProfessor',
  'HL3unconfirmed',
  'dota2betterthanlol',
  'townofvaluemayor',
  '44dolphinsswimming',
  'LordCount',
  'INsteadOfalways',
  'finally18',
  'stupidhorses',
  'abrokenpencil',
  'hurrAdurrB',
  'CbeforeD',
  'promotehunger',
  'infinitenothing',
  'insanepsychologist',
  'LnearM',
  'maybeAbattousai',
  'Gindidit',
  'kassiyva,',
  'Alwaysbetrayed',
  'lovemesenpai',
  'themaymaymeme',
  'proactivehater4L',
  'determineurf8m8',
  'gigakoopatroops',
  'onethirdtriforce',
  'QQbeforeSleep',
  'chickenb4eggmorph',
  'silitharsalad',
  'PLZFrenzyMe',
  '7maskball',
  'NinjasBeatPirates',
  'thejuicegoose',
  'vivalascartas',
  'negligentcashier',
  'tipmorethan15',
  'HUUUUGEDraw',
  'how2trainurmagmar',
  'notebookminusbook',
  'constantlyjudgingu',
  'aloli',
  'gosumaster',
  'dontcallmeapervert',
  'radicaldude',
  'wambothemagician',
  'GAHsofrustrated',
  'dictatorchan',
  'ultraironman',
  'managementjerk',
  'zombiepizza',
  '20underpantgnomes',
  'simplydelish',
  'pizzafor5bucks',
  'funisunderrated',
  'airportsecurity',
  'theyoungmiyagi',
  'jeeezthatsabeating',
  'informedmastermind',
  'hihellohola',
  'konbanwaoraora',
  '123punchesofdeath',
  'dontgivemeTHAT',
  'surprisinglynormal',
  'whysomanyheals',
  'tankingeternity',
  'allyourstuffdies',
  'dontthreatenmefool',
  'killingyouslowly',
  'sliceyoufinely',
  'thehighestdps',
  'ultrasupermeter',
  'shoryuhadouken',
  'thegraveenforcer',
  'manytimesover',
  'minimalabuseneeded',
  'Iwillmakeucrytwice',
  'IdiotMKII',
  'protagoantagonist',
  'themaincharacter',
  'subplotawaits',
  'surpriseendingNO2',
  'yesterdaysmemes',
  'IQQorYouQQ',
  'donthesitatemate',
  'BeardMan',
  'CalvintheClown',
  'jGOE94',
  'HollywoodHero',
  'ChazzThunderstorm',
  'Sporella',
  'THernando',
  'Alysiel',
  'LarryTheHotStew',
  'GoblinFanaticR',
  'TheDangerous',
  'TwoToeTim',
  'yoyokid2000',
  'CHdangerX',
  'TrelCryptic',
  'conTAGiousDAN',
  'SikEmRex',
  'AyraHoshira',
  'LaustKoz',
  'dawnNdusk',
  '3Delephant',
  '4pok4lyptik',
  '500degrees',
  'ABNorman',
  'ColonelKiwi',
  'DromonSerpenthelm',
  'laerynb',
  'AgentSmiths',
  '3GetsuWolf',
  'SnakeFutago',
  'AntiqueKitten',
  'alexomorse',
  'CyrptZmobie',
  'ultimateXalucard',
  'AmandaPanda10',
  'anscensiom',
  'lv80toysoldier',
  'forzenSOLID',
  'EigoTomodachi',
  'grapplerRoyson',
  'alucard',
  'EdRunSonata',
  'SweetTeaMahone',
  'shadowborne300',
  'PalpyrusSpaghetti',
  'dojobuster157',
  'ktARRIVES',
  'ARandomSquirrel',
  'DKarateMastr',
  'raithelightning',
  'AonqKpap14',
  'PettAddogue',
  'NoHonorOnlyGlory',
  'TieDyeFrenchFry',
  'kelsalopolis',
  'GR8NamuNamu',
  'PandaLover55',
  'Greilhror',
  'ArcaneKirone',
  'dali5662',
  'dragontamer582',
  'DisaPEAR',
  'JayTeeOh',
  'viraLspiraL',
  'MooberryBluffin',
  'URPo5yy',
  'broketehinterwebs',
  'xXFinalFormXx',
  'WetShirt',
  'ChainLinkHero',
  'chibiKIWI',
  'crisDLRx',
  'chronoswordsman',
  'LetsPlaySteven',
  'coldSteelpersonell',
  'AWFlakAttak',
  'jenWWNFA',
  'comradeIrdium',
  'DudeBrotato',
  'TrioTheWanderer',
  'SimpleKeyweilder',
  'DwewydaKat',
  'e8newen',
  'RishranElven',
  'GGwhatsnext',
  'aloneinapondofturtles',
  'NaniOni',
  'LazerTazerTZZ',
  'koodragonguy',
  'steamboatwalter',
  'oUtCaStShAdOw',
  'bladeTHEsnade',
  'ZZgavin',
  '7hatsmith7',
  'epikFROSST',
  'TuxedoTim98',
  'snowmanhotlava',
  'ezzaron',
  'FieryHuntmaster',
  'wolfgang87',
  'FlowerBadgeTAS',
  'hyagutenshi',
  'TimeLord3000',
  'iBrainc62',
  'igorhorsenstov',
  'lycanxahri',
  'isabella552',
  'TimePairOfSocks',
  'jatoTHEbatter',
  'hipMemeisbip',
  'jordie37992',
  'MrLadyBug',
  'NierHabeem',
  'unblockableonline',
  'frameperfectPETE',
  'LurienUngerd',
  'mOOnshadOw0',
  'mystORCHID',
  'mcHOTDOG85',
  'nmbr1gmr',
  'OcfnXFD33',
];

console.log('creating users');
const createUsers = _.map(usernames, function (username) {
  console.log(`creating user: ${username}`);
  return UsersModule.createNewUser(`u-${username}@test.test`, username, generatePushId(), 'kumite14')
    .bind(this)
    .then(function (userId) {
      console.log(`created: ${username} as ${userId}`);
      this.userId = userId;
      this.portraitId = 20001; // PortraitLookup[_.sample(_.keys(PortraitLookup))]
      return knex('users').where('id', this.userId).update({ is_bot: true, portrait_id: this.portraitId });
    }).catch((error) => {
      console.error(`ERROR: ${error.message}`);
    })
    .then(() => DuelystFirebase.connect().getRootRef())
    .then(function (fbRootRef) {
      if (this.userId) {
        return FirebasePromises.update(fbRootRef.child('users').child(this.userId).child('presence'), {
          rank: 30,
          portrait_id: this.portraitId,
        });
      }
      return null;
    })
    .catch((error) => {
      console.error(`ERROR: ${error.message}`);
      throw error;
    });
}, { concurrency: 1 });

Promise.all(createUsers).then(() => {
  process.exit(1);
});
